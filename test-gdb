#!/usr/bin/env bash
set -eux
for gem5 in '' --gem5; do
  ./run --arch arm --background --baremetal add $gem5 --wait-gdb &
  ./run-gdb --arch arm --baremetal add $gem5 --test "$@"
  wait
  ./run --arch arm --background --baremetal arch/arm/add $gem5 --wait-gdb &
  ./run-gdb --arch arm --baremetal arch/arm/add $gem5 --test "$@"
  wait
  ./run --arch arm --background --baremetal arch/arm/regs $gem5 --wait-gdb &
  ./run-gdb --arch arm --baremetal arch/arm/regs $gem5 --test "$@"
  wait
  ./run --arch aarch64 --background --baremetal add $gem5 --wait-gdb &
  ./run-gdb --arch aarch64 --baremetal add $gem5 --test "$@"
  wait
  ./run --arch aarch64 --background --baremetal arch/aarch64/add $gem5 --wait-gdb &
  ./run-gdb --arch aarch64 --baremetal arch/aarch64/add $gem5 --test "$@"
  wait
  ./run --arch aarch64 --background --baremetal arch/aarch64/regs $gem5 --wait-gdb &
  ./run-gdb --arch aarch64 --baremetal arch/aarch64/regs $gem5 --test "$@"
  wait
  ./run --arch aarch64 --background --baremetal arch/aarch64/fadd $gem5 --wait-gdb &
  ./run-gdb --arch aarch64 --baremetal arch/aarch64/fadd $gem5 --test "$@"
  wait
  ./run --arch aarch64 --background --baremetal arch/aarch64/regs $gem5 --wait-gdb &
  ./run-gdb --arch aarch64 --baremetal arch/aarch64/regs $gem5 --test "$@"
  wait
done
